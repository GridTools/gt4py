# Only /workspace folder is preserved on restarts, therefore both the Python
# virtual environment and pre-commit caches have to be installed there
image:
  file: .gitpod.Dockerfile
tasks:
- name: Setup venv and dev tools
  init: |
    ln -s /workspace/gt4py/.gitpod/.vscode /workspace/gt4py/.vscode
    python -m venv .venv
    source .venv/bin/activate
    pip install --upgrade pip setuptools wheel
    pip install -e .
    pip install -r requirements-dev.txt
    pip install -i https://test.pypi.org/simple/ atlas4py
    pre-commit install --install-hooks
    sed 's%# start templated%# start templated\nsource /workspace/gt4py/.venv/bin/activate%' /workspace/gt4py/.git/hooks/pre-commit -i
    deactivate
  command: source .venv/bin/activate
  env:
    PIP_SRC: _external_src
    PRE_COMMIT_HOME: /workspace/.caches/pre-commit
vscode:
  extensions:
  - ms-python.python
  - ms-toolsai.jupyter
  - ms-toolsai.jupyter-keymap
  - ms-toolsai.jupyter-renderers
  - genuitecllc.codetogether
