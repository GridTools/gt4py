default_language_version:
  python: python3.10
minimum_pre_commit_version: 3.8.0
repos:
# - repo: meta
#   hooks:
#   - id: check-hooks-apply
#   - id: check-useless-excludes

- repo: https://github.com/macisamuele/language-formatters-pre-commit-hooks
  rev: v2.14.0
  hooks:
  - id: pretty-format-ini
    args: [--autofix]
  - id: pretty-format-toml
    args: [--autofix]
    exclude: tach.toml
  - id: pretty-format-yaml
    args: [--autofix, --preserve-quotes, --indent, "2"]

- repo: https://github.com/pre-commit/mirrors-prettier
  rev: v4.0.0-alpha.8
  hooks:
  - id: prettier
    types_or: [markdown, json]

- repo: https://github.com/Lucas-C/pre-commit-hooks
  rev: v1.5.5
  hooks:
  - id: insert-license
    exclude: ^\..*$
    types: [python]
    args: [--comment-style, "|#|", --license-filepath, ./HEADER.txt, --fuzzy-match-generates-todo]

- repo: https://github.com/pre-commit/pre-commit-hooks
  rev: v5.0.0
  hooks:
  - id: check-case-conflict
  - id: check-merge-conflict
  - id: check-toml
  - id: check-yaml

- repo: local
  hooks:
  - id: uv-lock
    name: uv-lock
    description: "Automatically run 'uv lock' on your project dependencies"
    entry: uv lock
    files: ^(uv\.lock|pyproject\.toml|uv\.toml)$
    pass_filenames: false
    language: python
    additional_dependencies: [uv]
    stages: [pre-commit]
  - id: ruff-check
    name: ruff checker
    entry: uv run --frozen --isolated ruff check --force-exclude --fix
    types_or: [python, pyi, jupyter]
    files: ^src/  # TODO(egparedes): also add the `tests` folder here
    require_serial: true
    language: python
    additional_dependencies: [uv]
    stages: [pre-commit]

  - id: ruff-format
    name: ruff formatter
    entry: uv run --frozen --isolated ruff format --force-exclude --fix
    types_or: [python, pyi, jupyter]
    require_serial: true
    language: python
    additional_dependencies: [uv]
    stages: [pre-commit]

  - id: tach
    name: tach module dependency checker
    entry: uv run --frozen --isolated tach check
    pass_filenames: false
    language: python
    additional_dependencies: [uv]
    stages: [pre-commit]

  - id: mypy
    name: mypy static type checker
    entry: uv run --frozen --isolated mypy --no-install-types src/
    types_or: [python, pyi]
    require_serial: true
    pass_filenames: false
    language: python
    additional_dependencies: [uv]
    stages: [pre-commit]

  - id: noxfile-utils
    name: noxfile-utils checker
    entry: >
      bash -c "
        uv run --frozen --isolated python noxfile_utils.py ;
        uv run --frozen --isolated mypy --no-install-types noxfile_utils.py
      "
    language: python
    pass_filenames: false
    additional_dependencies: [uv]
    stages: [pre-commit]
